<!DOCTYPE html>
<html lang="en">
<!-- default layout-->
<!--map layout see _layouts/map.html-->
<head>
  <!--meta content and open graph tags for social sharing see _includes/metal.html-->
  <title>Vector Tile Test: PBF | OVRDC</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@ovrdc">
  <meta name="twitter:creator" content="@ovrdc">
  <meta name="twitter:title" content="Vector Tile Test: PBF">
  <meta name="twitter:description" content="Scioto County Parcels">
  <meta name="twitter:domain" content="www.ovrdc.org" />
  <meta name="twitter:image" content="https://www.ovrdc.org/apps/assets/post-images/large/parcels.png" />
  <!--Open Graph meta data-->
  <meta property="og:title" content="Vector Tile Test: PBF" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="" />
  <meta property="og:image" content="https://www.ovrdc.org/apps/assets/post-images/landscape/parcels.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="627" />
  <meta property="og:image" content="https://www.ovrdc.org/apps/assets/post-images/large/parcels.png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="1200" />
  <meta property="og:description" content="Scioto County Parcels" />
  <meta property="og:url" content="https://www.ovrdc.org/apps/vector-grid-pbf.html" />
  <!--end meta and open graph-->

  <!--global fonts and jquery-->
  <link href='//fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400italic,400,800,700|Archivo+Narrow:400,700|Archivo+Black' rel='stylesheet' type='text/css'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js" integrity="sha256-wS9gmOZBqsqWxgIVgA8Y9WcQOa7PgSIX+rPA0VL2rbQ=" crossorigin="anonymous"></script>
  <!--Font Awesome CDN and Bootstrap CSS -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <!--script type="text/javascript">$(document).ready(function () { $('.dropdown-toggle').dropdown(); }); </script-->

  <!--Begin Map CSS and JS see _includes/map-header.html-->
  <script src="https://maps.google.com/maps/api/js?v=3"></script>
  
  <link rel="stylesheet" href="https://www.ovrdc.org/apps/assets/ovrdc-map-plugins-leaflet-v1.css" />
  <script src="https://www.ovrdc.org/apps/assets/ovrdc-map-plugins-leaflet-v1.js"></script>
  <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.css" rel='stylesheet' />
  <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.38.0/mapbox-gl.js"></script>
  <script src="https://www.ovrdc.org/apps/assets/cssjs/leaflet-mapboxgl/leaflet-mapboxgl.js"></script>
  
  
  <link rel="stylesheet" href="https://www.ovrdc.org/apps/assets/ovrdc-css/modern-ui.css" />
  <!--End Leaflet Plugins-->
  
  
  
  
  
  
  <!--additional page plugins see map-plugins.html and _data/plugins.yml -->
    
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- vector-grid -->
  
  
  <script src="https://www.ovrdc.org/apps/assets/cssjs/Leaflet.VectorGrid/Leaflet.VectorGrid.bundled.js"></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- pip2 -->
  
  
  <script src="https://www.ovrdc.org/apps/assets/cssjs/leaflet-pip/leaflet-pip.min.js"></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <!-- jszip -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.0.2/jszip-utils.min.js"></script>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
<!-- end additional plugins-->
  <!--End Map CSS and JS-->
  <!--end plugins-->
  <style>*{font-family: "Open Sans", sans-serif;}</style>

</head>
<body>

<!--Start Map Template see _includes/map-template.html-->
<div class="blank"></div>
<div id="map">
  <div id="sidebar">
    <div id="mapTitle">
      <h1>Vector Tile Test: PBF</h1>
    </div>
    <div id="mapSubtitle"><h5>Scioto County Parcels</h5></div>
    <hr />
    <div id="mapDescription"></div>
    <div id="mapInfo"><h5> This map uses the Leaflet.VectorGrid plugin for Leaflet 1.0 with the Canvas Renderer (L.canvas.tile). The vector tiles are stored on Mapbox. Intead of calling a Mapbox style, the pbf files are accessed directly.</h5></div>
    <div id="mapLegend"></div>
    <div id="chartCenter" style="text-align:center"><canvas id="mapCanvas" style="display:none;"></canvas></div>
    <div id="mapLegendInfo"></div>
    
<div>
  <hr />
  <button id="showTools" type="button" class="btn btn-default btn-xs btn-block">Show Map Tools Legend</button>
  <button id="hideTools" type="button" class="btn btn-default btn-xs btn-block" style="display:none;">Hide Map Tools Legend</button>
  <div class="toolLegend" style="display:none;">
    <hr />
    <div class="list-group" style="text-align:left;">
      <li class="list-group-item"><i class='fa fa-bars fa-fw fa-lg'></i> Open Sidebar</li>
      
      <li class="list-group-item"><i class='fa fa-exchange fa-fw fa-lg'></i> Toggle Address Search</li>
      
      <li class="list-group-item"><img src="https://www.ovrdc.org/apps/assets/images/fullscreen-img.png" style="padding:0 1px;width:22px;"></img> Fullscreen</li>
      <li class="list-group-item"><i class='fa fa-globe fa-fw fa-lg'></i> Default Map Extent</li>
      <li class="list-group-item"><i class='fa fa-map-marker fa-fw fa-lg'></i> Show/Follow Your Location</li>
      
      <li class="list-group-item"><i class='fa fa-cogs fa-fw fa-lg'></i> Toggle Map Tools (Mobile Only)</li>
      <li class="list-group-item"><img src="https://www.ovrdc.org/apps/assets/cssjs/images/layers-bl.png" style="padding:0 1px;width:22px;"></img> Toggle Map Layers</li>
      
    </div>
  </div>
  <hr />
</div>
<script>
$("#showTools").click(function() {
  $(".toolLegend").toggle();
  $("#showTools").toggle();
  $("#hideTools").toggle();
});
$("#hideTools").click(function() {
  $(".toolLegend").toggle();
  $("#showTools").toggle();
  $("#hideTools").toggle();
});
</script>

    <div id="mapNote"></div>
    <div id="sidebarFooter">
      <a href='http://www.ovrdc.org' target='blank' style='text-decoration:none;'>OVRDC</a> |
      <a href="http://www.ovrdc.org/maps">Map Index</a> |
      <a href="#" data-toggle="modal" data-target="#introModal"><i class="fa fa-info-circle"></i> Map Info</a> |
      
    </div>
    <span class="text-muted">Updated: 02/28/2017</span>
  </div>
</div>
<!--_includes/footer.html-->
</body>
<footer>
  
  <!-- Modal -->
  <div class="modal fade" id="introModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h2 class="modal-title">Vector Tile Test: PBF</h2>
        </div>
        <div class="modal-body">
          <h5> This map uses the Leaflet.VectorGrid plugin for Leaflet 1.0 with the Canvas Renderer (L.canvas.tile).</h5>
The vector tiles are stored on Mapbox. Intead of calling a Mapbox style, the pbf files are accessed directly.
This map demonstrates the capability of <a href="http://leafletjs.com/" target="_blank" > Leaflet </a> to render thousands of polygons using <a href="https://www.mapbox.com/blog/introducing-geojson-vt/" target="_blank">Vector Tiles</a> on both desktop and mobile devices. Rendering, search and identify are handled by the browser, so there is no need for GeoServer/ArcGIS Server, etc., to push data to the client. The original shapefile was converted to geoJSON using esri2open, then to mbtiles using tippecanoe. The tiles are served via mbtiles-server, and rendered using Leaflet 1.0 and Leaflet Vector Grid.
        </div>
        <div class="modal-footer">
          <span id="loadingMessage" class="animate-flicker" style="float:left;color:red;"></span><button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>

    </div>
  </div>
  
  
  <script>
/*_includes/analytics.js*/
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63802107-1', 'auto');
ga('send', 'pageview');
</script>

</footer>

<script>


$('#introModal').modal('show');

$('#introModal').on('shown.bs.modal', setTimeout(function(e) {
  console.log('starting to load map');
  initiateLeafletMap();
},50));

function initiateLeafletMap() {

var windowUrl = window.location.href;
$("#sidebarFooter").append("<a href='https://docs.google.com/forms/d/e/1FAIpQLSd53cAsweLYkkr75KUpN6lHpsQcKbV9XoRNtJEsFsUHdVIVuw/viewform?entry.1286129613&entry.2022340261&entry.519867356=" + windowUrl + "' target='_blank'>Feedback</a>");

/*--OVRDC Jekyll Map Layout "template: true" --*/
var mapOptions;
if (L.Browser.mobile) {
    mapOptions = {
    zoomControl:false,
    center: [38.7581,-82.9718],
    zoom: 13,
    maxZoom: 19,
    minZoom: 12,
    sleep: false,
    sleepNote: false,
    visualClickEvents: 'click',
  };
}
if (!L.Browser.mobile) {
    mapOptions = {
    zoomControl:false,
    center: [38.7581,-82.9718],
    zoom: 13,
    maxZoom: 19,
    minZoom: 12,
    sleep: false,
    sleepNote: false,
    visualClickEvents: 'click',
  };
}

var map = new L.map('map', mapOptions);

map.spin(true);
/*_includes/map-tiles.js*/
/*Attribution Toggle and OSM Edit Link*/
//remove existing attribution control by hiding it only on mobile
//make sure the normal control is hidden
var style = document.createElement('style');
style.type = 'text/css';
style.innerHTML = '.leaflet-control-attribution {display: none;};@media screen and (max-width:768px) {.elevation.leaflet-control {display:none}}';
document.getElementsByTagName('head')[0].appendChild(style);

if (L.Browser.mobile) {
  console.log('mobile');
  var toggleAttribution = L.Control.extend({
    options: { position: 'bottomright' },
    onAdd: function (map) {
      this._div = L.DomUtil.create('button', 'btn btn-link');
      this._div.innerHTML = "Leaflet | Map Tiles";
      L.DomEvent.on(this._div, 'click', this._click);
      return this._div;
    },

    _click: function (e) {
      L.DomEvent.stop(e);
      x = document.getElementsByClassName("leaflet-control-attribution")[0];
      x.style.display = x.style.display === 'block' ? '' : 'block';
    },

  });
  map.addControl(new toggleAttribution());
}else{
  x = document.getElementsByClassName("leaflet-control-attribution")[0];
  x.style.display = x.style.display === 'block' ? '' : 'block';
}
//Add link to edit OpenStreetMap at the current map location
var osmEdit = L.geoJson();
osmEdit.getAttribution = function() { return "<span id='osmEditLink'><a href='#'>Edit OSM</a></span>"; };
osmEdit.addTo(map);
function osmEditAdd() {
  var osmEditLink = document.getElementById('osmEditLink');
  osmEditLink.addEventListener('click', function () {
    var osmEditZoom = map.getZoom();
    var osmEditCenter = map.getCenter();
    console.log(osmEditCenter);
    window.open("http://www.openstreetmap.org/#map=" + osmEditZoom + "/" + osmEditCenter.lat + "/" + osmEditCenter.lng + "&layers=N");
  });
}
document.onload = function() {
  setTimeout(function() {osmEditAdd()}, 5000);
}
//End Attribution Toggle
//--begin map-tiles
/*var ogrip = L.esri.imageMapLayer({
  url: '//geo.oit.ohio.gov/arcgis/rest/services/OSIP/osip_best_avail_1ft/ImageServer',
});
var ogripTiles = L.esri.tiledMapLayer({
  url:'//gis5.oit.ohio.gov/ArcGIS/rest/services/WM_OSIP_II/MapServer/3',
});*/


//OpenMapTiles basemaps served from the OVRDC Vector Tile Server on a Digital Ocean Droplet using mbtiles-server OST updated 1/25/2017
//var omtAttribution = "<a href=\"http://www.ovrdc.org/gis\" target=\"_blank\"><i class='fa fa-creative-commons ' aria-hidden='true'></i>&nbsp;OVRDC</a>&nbsp;<a href=\"http://openmaptiles.org/\" target=\"_blank\"><i class='fa fa-copyright' aria-hidden='true'></i>&nbsp;OpenMapTiles</a>&nbsp;<a href=\"http://www.openstreetmap.org/about/\" target=\"_blank\"><i class='fa fa-copyright' aria-hidden='true'></i>&nbsp;OpenStreetMap</a>";

var mapboxAtt = '<a href="https://www.mapbox.com/about/maps/" target="_blank">© Mapbox</a>| <a href="http://www.openstreetmap.org/about/" target="_blank">© OpenStreetMap</a></div>';

var mapboxToken = "pk.eyJ1Ijoib3ZyZGMiLCJhIjoiY2pjbHpsNTNhMGxpOTJ3cm4xODE3bGpsaSJ9.YvQrP4s_CIuz365le0eMQg";

var osm = L.mapboxGL({
  accessToken: mapboxToken,
  //style: 'https://tileserver.ovrdc.org/tileserver-styles/styles/osm-bright/style.json',
  style: 'mapbox://styles/mapbox/streets-v9',
  //attribution: omtAttribution
  attribution: mapboxAtt
});
var cdblight = L.mapboxGL({
  accessToken: mapboxToken,
  //style: 'https://tileserver.ovrdc.org/tileserver-styles/styles/positron/style.json',
  style: 'mapbox://styles/mapbox/light-v9',
  //attribution: omtAttribution
  attribution: mapboxAtt
});
var cdbdark = L.mapboxGL({
  accessToken: mapboxToken,
  //style: 'https://tileserver.ovrdc.org/tileserver-styles/styles/dark-matter/style.json',
  style: 'mapbox://styles/mapbox/dark-v9',
  //attribution: omtAttribution
  attribution: mapboxAtt
});

var osmhot = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
	maxZoom: 19,
	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles courtesy of <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>'
});

var ggleterrain = new L.Google('TERRAIN', {
  maxZoom: 21,
  maxNativeZoom: 19,
});

var ggle = new L.Google('HYBRID', {
  maxZoom: 20,
  maxNativeZoom: 19,
});

var ggleroadmap = new L.Google('ROADMAP', {
  mapOptions: {
    styles: style,
  },
  maxZoom: 21,
  maxNativeZoom: 19,
  });
var stamentoner = new L.tileLayer.provider('Stamen.Toner');
var stamentonerlight = new L.tileLayer.provider('Stamen.TonerLite');
var watercolor = L.tileLayer('//stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png', {
   attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
   subdomains: 'abcd',
   maxNativeZoom: 14,
   maxZoom: 17,
   ext: 'png',
 });

var thundertransport = L.tileLayer('https://{s}.tile.thunderforest.com/transport/{z}/{x}/{y}.png?apikey=44069acaa3c74efb8784566e1c53b66f', {
  attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>, &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  maxZoom: 19,
});
var esrigray = L.tileLayer('//server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
  maxNativeZoom: 16,
  maxZoom: 19,
});
var esritopo = L.tileLayer('//server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
  attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community',
  maxZoom: 22,
  maxNativeZoom: 18,
});

var ortho = L.tileLayer('https://api.tiles.mapbox.com/v4/mapbox.streets-satellite/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoib3ZyZGMiLCJhIjoiY2pjbHpsNTNhMGxpOTJ3cm4xODE3bGpsaSJ9.YvQrP4s_CIuz365le0eMQg', {
  attribution: '<a href="https://mapbox.com/about/maps/">MapBox</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  subdomains: 'abcd', maxZoom: 22, maxNativeZoom: 19,
});
var streets = osm;
var topo = esritopo;
var light = cdblight;
var dark = cdbdark;
var transit = thundertransport;
var basemaps = {
  "<div class='layers-control-img'><img src='https://www.ovrdc.org/apps/assets/images/layer-control-images/osm-streets.png'></div> Streets": osm,
  "<div class='layers-control-img'><img src='https://www.ovrdc.org/apps/assets/images/layer-control-images/mapbox-ortho.png'></div> Satellite": ortho,
  "<div class='layers-control-img'><img src='https://www.ovrdc.org/apps/assets/images/layer-control-images/esri-topo.png'></div> Topography": esritopo,
  "<div class='layers-control-img'><img src='https://www.ovrdc.org/apps/assets/images/layer-control-images/transit.png'></div> Transit": transit,
  "<div class='layers-control-img'><img src='https://www.ovrdc.org/apps/assets/images/layer-control-images/cdb-light.png'></div> Grayscale": cdblight,
  "<div class='layers-control-img'><img src='https://www.ovrdc.org/apps/assets/images/layer-control-images/cdb-dark.png'></div> Dark Matter": cdbdark,
};
var ovrdcScale = L.control.scale({metric: false, imperial: true}).addTo(map);
//--show google imagery at higher zoom levels
//--add mpabox back to map after zoom 20
map.on('zoomend', function () {
  if (map.getZoom() > 18 && map.hasLayer(ortho)) {
    map.removeLayer(ortho);
    $('.leaflet-control-scale').css('margin-bottom', '25px');
    map.addLayer(ggle);
  }

  if (map.getZoom() < 19 && map.hasLayer(ggle))
  {
    map.removeLayer(ggle);
    $('.leaflet-control-scale').css('margin-bottom', '5px');
    map.addLayer(ortho);
  }
});

map.on('baselayerchange', function () {
  map.panBy([1,1]);
  if (map.getZoom() > 18 && map.hasLayer(ggle)) {
    map.removeLayer(ggle);
    $('.leaflet-control-scale').css('margin-bottom', '5px');
  }
  if (map.getZoom() > 18 && map.hasLayer(ortho)) {
    map.removeLayer(ortho);
    $('.leaflet-control-scale').css('margin-bottom', '25px');
    map.addLayer(ggle);
  }
});

var layerControl = L.control.layers(basemaps, null, { position: 'topright', autoZIndex: true }).addTo(map);

//--end map-tiles
//--custom icons--//
var ovrdcIcon = L.Icon.extend({
  options: {
//   shadowUrl: 'leaf-shadow.png',
  iconSize:     [32, 37], // size of the icon
//   shadowSize:   [50, 64], // size of the shadow
  iconAnchor:   [16, 35], // point of the icon which will correspond to marker's location
//  shadowAnchor: [4, 62],  // the same for the shadow
  popupAnchor:  [0, -32] // point from which the popup should open relative to the iconAnchor
  }
});
//--//
//--End map-tiles.js--//

/*--end map tiles--begin toolbar*/
/* _includes/map-toolbar.js */
console.log('start map toolbar');
//OVRDC Modern UI Toolbar
//OVRDC New marker
var ovrdcMarker = L.icon({
    iconUrl: 'https://www.ovrdc.org/apps/assets/images/ovrdc-marker.png',
    //shadowUrl: 'leaf-shadow.png',

    iconSize:     [48, 48], // size of the icon
    //shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [24, 42], // point of the icon which will correspond to marker's location - half the width and height of icon
    //shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [0, -42] // point from which the popup should open relative to the iconAnchor
});
//end marker
var overlays;
var sidebar = L.control.sidebar('sidebar', { autoPan: false, closeButton: false });
sidebar.addTo(map);
//Leaflet Search with OSM Geocode

var osmsearch = new L.Control.Search({
    url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
    jsonpParam: 'json_callback',
    propertyName: 'display_name',
    propertyLoc: ['lat','lon'],
    circleLocation: false,
    autoType: false,
    autoCollapse: false,
    minLength: 2,
    zoom:13,
    textPlaceholder: 'Search Addresses',
    collapsed: false
  });
osmsearch.addTo(map);
var circle;
var marker;
osmsearch.on('search_locationfound', function(e) {
  osmsearch.collapse();
  if(marker){
    map.removeLayer(marker);
  }
  var name = e.display_name;
  marker = new L.marker([e.latlng.lat, e.latlng.lng], {icon: ovrdcMarker}).addTo(map);
});

//Toggle OSM Search and Feature Search - remove if no feature search
var hash = L.hash(map);
var gpsLocate = L.control.locate({follow: true, locateOptions: {enableHighAccuracy: true}});
//gpsLocate.addTo(map);
var homeExtent = L.control.defaultExtent({});
//homeExtent.addTo(map);
var fullscreen = L.control.fullscreen();

var globalsearchToggle = new L.easyButton({
    states: [{
      stateName: 'show',
      icon: 'fa-exchange fa-lg',
      title: 'Search Addresses',
      onClick: function(btn, map) {
        osmsearch.addTo(map);
      btn.state('hide');
        }
      },{
      stateName: 'hide',
    icon: 'fa-exchange fa-border fa-lg',
      title: 'Search Features',
      onClick: function(btn, map) {
        map.removeControl(osmsearch);
        btn.state('show');
      }
    }]
  });
//globalsearchToggle.addTo(map);

var sidebarToggle = L.easyButton({
      states: [{
              stateName: 'open-sidebar',   // name the state
              icon:      'fa-bars fa-lg',          // and define it's properties
              title:     'Show Sidebar', // like it's title
              onClick: function(btn, map) {  // and it's callback
                  sidebar.show();
                  btn.state('close-sidebar'); // change state on click!
              }
          }, {
              stateName: 'close-sidebar',
              icon:      'fa-times fa-2x',
              title:     'Hide Sidebar',
              onClick: function(btn, map) {
                  sidebar.hide();
                  btn.state('open-sidebar');
              }
      }],
    id: 'menu',
 });
var stogglebar = L.easyBar([sidebarToggle], {id: 'toggle'}).addTo(map);
var leafletprint = L.easyPrint();
//end toolbar
sidebar.on('hide', function () {
    sidebarToggle.state('open-sidebar');
});
sidebar.on('show', function () {
    sidebarToggle.state('close-sidebar');
});
//mobile toolbar menu
//--tools toggle on small screens
var toolshidden = false;
var mobilescreen = false;
var tools = L.easyButton({
      states: [{
              stateName: 'show-tools',   // name the state
              icon:      'fa-cogs fa-lg',          // and define it's properties
              title:     'Show Map Tools', // like it's title
              onClick: function(btn, map) {  // and it's callback
                  leafletprint.addTo(map);
                  gpsLocate.addTo(map);
                  homeExtent.addTo(map);
                  fullscreen.addTo(map);
                  
                  globalsearchToggle.addTo(map);
                  
                  btn.state('hide-tools'); // change state on click!
                  toolshidden = false;
                  //console.log(toolshidden + ' state changed to hideTools');
              }
          }, {
              stateName: 'hide-tools',
              icon:      'fa-cogs fa-border fa-lg',
              title:     'Hide Map Tools',
              onClick: function(btn, map) {
                  map.removeControl(leafletprint);
                  map.removeControl(gpsLocate);
                  map.removeControl(homeExtent);
                  map.removeControl(fullscreen);
                  
                  map.removeControl(globalsearchToggle);
                  
                  btn.state('show-tools');
                  toolshidden = true;
                  //console.log(toolshidden+ ' state changed to showTools');
              }
      }],
    id: 'tools',
 });
console.log('tools loaded');
var w = window.innerWidth;
console.log('screen width: ' + w);
if (w < 481) {
  tools.addTo(map);
  toolshidden = true;
  mobilescreen = true;
  //console.log('mobile tool toggle');
  //console.log(toolshidden + "mobilescreen: " + mobilescreen);
}else{
  leafletprint.addTo(map);
  gpsLocate.addTo(map);
  homeExtent.addTo(map);
  fullscreen.addTo(map);
  
  globalsearchToggle.addTo(map);
  
  toolshidden = false;
  //console.log(toolshidden + " " + mobilescreen);
}
window.onresize = function() {
  if ( toolshidden === true && window.innerWidth > 480 && mobilescreen === true) {
    leafletprint.addTo(map);
    gpsLocate.addTo(map);
    homeExtent.addTo(map);
    fullscreen.addTo(map);
    
    globalsearchToggle.addTo(map);
    
    map.removeControl(tools);
    toolshidden = false;
    mobilescreen = false;
    //console.log(toolshidden + " " + mobilescreen);
  }
  else if ( toolshidden === false && mobilescreen === true && window.innerWidth > 481) {
    tools.state('show-tools');
    mobilescreen = false;
    map.removeControl(tools);
    //console.log(toolshidden + "" + mobilescreen);
  }
  else if ( toolshidden === false && window.innerWidth < 481 && mobilescreen === false) {
    map.removeControl(leafletprint);
    map.removeControl(gpsLocate);
    map.removeControl(homeExtent);
    map.removeControl(fullscreen);
    
    map.removeControl(globalsearchToggle);
    
    tools.addTo(map);
    toolshidden = true;
    mobilescreen = true;
    //console.log(toolshidden + " " + mobilescreen);
  }
  else {}
};
//--end tools toggle

//Close Layer Control on Layer Change
//Close Layer Control on Layer Change on mobile
map.on('baselayerchange', function() {
 if (L.Browser.mobile) {
   map.on('baselayerchange', function() {
     setTimeout(function() {
       $(".leaflet-control-layers").removeClass("leaflet-control-layers-expanded");
     },5000);
   });
 }
});
//end mobile tools menu
var loading = L.Control.loading({position:'topright'}).addTo(map);
//end OVRDC Modern UI Toolbar



light.addTo(map);




window.onload = function () {
  $(".blank").fadeOut();
  setTimeout(function() {
    console.log('map loaded spin false');
    sidebar.show();
    map.spin(false);
  }, 500);
}


//--Begin custom zoom--//
map.removeControl(loading);
var customZoom = L.control.zoom({position:'topright'}).addTo(map);
loading.addTo(map);
//--end zoom--//
//--End Map template--//
//////////////////////////////
//--Begin Map Post .js Content--//
var test = {};
mapboxgl.accessToken = 'pk.eyJ1Ijoib3ZyZGMiLCJhIjoiY2plcjJ4MWZ5MGNqcDJ3bXZ3eDQ0N2tkMSJ9.w1q6j-h3nR6meHk4Ky8PTA'
map.createPane('parcelPane');
map.getPane('parcelPane').style.zIndex = 650;
https://b.tiles.mapbox.com/v4/ovrdc.9h65l843/{z}/{x}/{y}.vector.pbf
//var vectorTilePBFLayer = L.vectorGrid.protobuf("https://tileserver.ovrdc.org/tiles/sci-parcels-test/{z}/{x}/{y}.pbf", {
var vectorTilePBFLayer = L.vectorGrid.protobuf("https://b.tiles.mapbox.com/v4/ovrdc.9h65l843/{z}/{x}/{y}.vector.pbf?access_token=pk.eyJ1Ijoib3ZyZGMiLCJhIjoiY2pjbHpsNTNhMGxpOTJ3cm4xODE3bGpsaSJ9.YvQrP4s_CIuz365le0eMQg", {
  pane: "parcelPane",
  minZoom: 12,
  maxNativeZoom: 17,
  maxZoom: 22,
  rendererFactory: L.canvas.tile,
	attribution: '© OVRDC',
  interactive: true,
  getFeatureId: function(feature) {
    return feature.properties.geoid;
  },
	vectorTileLayerStyles: {
    "sci-parcels-geojson-79v4aw": {
      fillColor: "transparent",
      color: "orange",
      weight: 1,
      fillOpacity: 0.3
    }
  }
}).addTo(map);

layerControl.addOverlay(vectorTilePBFLayer, "Parcels");


var id = "";

var highlightLayer = {};

var x = 0;

function highlight(e) {
  console.log(e);
  if (e.layer.feature) {
    var latlng = [e.layer.feature.geometry.coordinates[1],e.layer.feature.geometry.coordinates[0]];
    console.log(latlng)
    var parcel = e.layer.feature.properties;
    var index = parcel.index.split(" | ");
    var pin = index[0];
    var name = index[1];
  }else{
    var latlng = [e.latlng.lat,e.latlng.lng];
    console.log(latlng)
    var parcel = e.layer.properties;
    var pin = parcel.PIN;
    var name  = parcel.NAME;
  }
  console.log(parcel);
  id = parcel.geoid;
  var popup = 'Parcel ID: ' + pin + '<hr>Name: ' + name;
  map.on('popupopen', function() {
    map.spin(false);
  });
  map.on('popupclose', function() {
    vectorTilePBFLayer.setFeatureStyle(id, {
      color: 'orange',
      weight: 1
    });
  });
  setTimeout(function() {
    vectorTilePBFLayer.setFeatureStyle(id, {
      color: 'red'
    });
    map.openPopup(popup, latlng);
    x = 0
  }, 50);
}

vectorTilePBFLayer.on('click', function(e) {
  if (x == 0) {
    highlight(e)
  }
  x = 1
});

var search
var searchLayer = L.geoJson();

searchLayerData = omnivore.csv("https://www.ovrdc.org/apps/assets/data/parcels/scioto/sci-parcels-test.csv", {
  latfield: 'y',
  lonfield: 'x'
}, searchLayer);

searchLayer.on('ready', function() {
  console.log('ready');
  $(".blank").fadeOut();
  map.spin(false);
  setTimeout(function() {
    sidebar.show()
  }, 500);
  //initiate search after parcel data has loaded
  search = new L.Control.Search({
    layer: searchLayer,
    propertyName: 'index',
    initial: false,
    //zoom: 17,
    moveToLocation: function(latlng, title, map) {map.flyTo(latlng, 17)},
    circleLocation:false,
    collapsed: false,
    textPlaceholder: 'Search by Name or Parcel ID',
    minLength: 4
  }).addTo(map);

  search.on('search_locationfound', function(e) {
    console.log('found');
    //console.log(e);
    map.closePopup();
    search.collapse();
    map.setView(e.latlng, 15);
    setTimeout(function() {
      highlight(e)
    }, 50);
  });
});

map.on('zoomend', function() {
  if (map.getZoom() < 13) {
    $("#mapLegend").html("<span style='color:red;'>Zoom in to view the parcel layer.</span>")
  }
  if (map.getZoom() > 12) {
    $("#mapLegend").html("");
  }
})

//--End Map Post .js Content--//

}

</script>



<!--end default layout-->
</html>
